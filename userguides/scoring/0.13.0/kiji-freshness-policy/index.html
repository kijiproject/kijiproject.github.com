
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>KijiFreshnessPolicy</title>
    <meta name="description" content="Description of KijiFreshnessPolicy SPI.">
    <meta name="author" content="WibiData">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/github.css" rel="stylesheet" type="text/css" media="all">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="/assets/themes/twitter/vallenato/vallenato.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/assets/themes/twitter/css/vallenato.css" type="text/css" media="screen">
  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="http://www.kiji.org">Kiji Community</a>
          <ul class="nav">
            <li class="dropdown">
              <a href="http://www.kiji.org">The Kiji Project</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/features">Features</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.kiji.org/architecture">Architecture</a>
            </li>
            <li class="dropdown">
              <a href="http://www.kiji.org/getstarted/">Get Started</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Downloads">Downloads</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Installation">Installation</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/get-started-with-maven">Getting Started with Maven</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Training_Services">
                    Training & Services
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="http://www.kiji.org/getinvolved">Get Involved</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Mailing_Lists">Mailing Lists</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Source_Code">Source Code</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Issue_Tracker">Issue Tracking</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Contributing_to_Kiji">
                    Contributing to Kiji
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown active">
              <a href="/">Documentation</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="/tutorials.html">Tutorials</a>
                </li>
                <li class="menu-item">
                  <a href="/userguides.html">
                    User Guides
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/apidocs">API Reference</a>
                </li>
                <li class="menu-item">
                  <a href="https://github.com/kijiproject/wiki/wiki">Wiki</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.kiji.org/blog/">Blog</a>
            </li>
            <li>
              <a href="http://www.kiji.org/aboutkiji">About Kiji</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="content">
        
<div class="row-fluid">
  <div class="span9">
    <div class="page-header">
      <h1>KijiFreshnessPolicy</h1>
    </div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
            
            
              <li class="prev">
                <a href="/userguides/scoring/0.13.0/what-is-scoring" title="What is Scoring">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      

      
      
        
        
          
            
            
          
        
          
        
          
        
          
            
            
              <li class="next">
                <a href="/userguides/scoring/0.13.0/score-function" title="ScoreFunction">
                Next &rarr;
                </a>
              </li>
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      
      </ul>
    </div>

    <div id="accordion-container">
  <h2 class="accordion-header"> KijiFreshnessPolicy.java </h2>
    <div class="accordion-content">
    <script src="http://gist-it.appspot.com/github/kijiproject/kiji-scoring/raw/kiji-scoring-root-0.13.0/src/main/java/org/kiji/scoring/KijiFreshnessPolicy.java"> </script>
  </div>
</div>




<h3 style="margin-top:0px;padding-top:10px;"> KijiFreshnessPolicy </h3>


<p>A <code>KijiFreshnessPolicy</code> governs the execution of a model by answering the question: “Is requested data fresh or stale?” If data is fresh, a new score is not needed and the current fresh data will be returned. If data is stale, a new score is needed and a <code>ScoreFunction</code> will run to generate that score. Most methods of a <code>KijiFreshnessPolicy</code> are helpers to provide input to the main method, <code>isFresh</code>, which answers this question.</p>

<p>Methods of a <code>KijiFreshnessPolicy</code> are divided into three categories based on when and where they are called.</p>

<p>Attachment time methods are called during Freshener registration in a <code>KijiFreshnessManager</code>.</p>

<ol>
<li><code>serializeToParameters</code> allows a policy to save its state into into the Freshener record so that it can be rebuilt in a fresh reader. An example of how this is used can be found in the stock <code>KijiFreshnessPolicy</code> provided in org.kiji.scoring.lib, ShelfLife which provides a convenience constructor and uses <code>serializeToParameters</code> to store the input values from that constructor into the Freshener record so that it is preserved while the Freshener is serialized.</li>
</ol>


<p>Setup and cleanup methods are called when a Freshener is loaded or unloaded from a <code>FreshKijiTableReader</code>.</p>

<ol>
<li><code>getRequiredStores(FreshenerGetStoresContext)</code> allows a policy to describe the <code>KeyValueStore</code>s it requires. All methods called after this, including <code>setup</code>, <code>cleanup</code>, and all request time methods can access these <code>KeyValueStore</code>s. <code>KeyValueStore</code>s can be used to access side data, for instance from a foreign Kiji table.</li>
<li><code>setup(FreshenerSetupContext)</code> configures the internal state of the policy.</li>
<li><code>cleanup(FreshenerSetupContext)</code> cleans up resources used by the policy.</li>
</ol>


<p>Request time methods are called while a Freshener is live in a <code>FreshKijiTableReader</code> in response to every read request which includes the column to which the Freshener is attached.</p>

<ol>
<li><code>shouldUseClientDataRequest(FreshenerContext)</code> allows the policy to choose what entity data it sees in <code>isFresh</code>. If this returns true, the row data passed to <code>isFresh</code> will be defined by the client’s data request which triggered this freshening.</li>
<li><code>getDataRequest(FreshenerContext)</code> specifies data to be passed to <code>isFresh</code> if <code>shouldUseClientDataRequest</code> returns false.</li>
<li><code>isFresh(KijiRowData, FreshenerContext)</code> determines if data is fresh or stale.</li>
</ol>


<p>KijiScoring provides several stock implementations of <code>KijiFreshnessPolicy</code> in the org.kiji.scoring.lib package. Included are: AlwaysFreshen, which returns false to <code>isFresh</code> in all cases; NeverFreshen, which returns true to <code>isFresh</code> in all cases; NewerThan, which returns true if requested data was written more recently than a configurable time; ShelfLife, which returns true if requested data was written within a configurable amount of time from the current time.</p>


    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
            
            
              <li class="prev">
                <a href="/userguides/scoring/0.13.0/what-is-scoring" title="What is Scoring">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      

      
      
        
        
          
            
            
          
        
          
        
          
        
          
            
            
              <li class="next">
                <a href="/userguides/scoring/0.13.0/score-function" title="ScoreFunction">
                Next &rarr;
                </a>
              </li>
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      
      </ul>
    </div>
  </div>

  <div class="span3">
    
      
      
    
    <div class="side-toc">
    <div class="side-toc-inner">
      <h3>KijiScoring User Guide</h3>
      <ul>
        
          
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/what-is-scoring">What is Scoring</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <b>KijiFreshnessPolicy</b>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/score-function">ScoreFunction</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/freshener-context">FreshenerContext</a>
                  
                </li>
              
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/lifecycle-of-a-freshener">Lifecycle of a Freshener</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/fresh-kiji-table-reader">FreshKijiTableReader</a>
                  
                </li>
              
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/metadata-management">Metadata Management</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/scoring/0.13.0/pmml-score-function">PMML ScoreFunction</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
      </ul>
      <h3>Need Help?</h3>
      <ul>
        <li>
      <a class="btn btn-info"  href="https://groups.google.com/a/kiji.org/forum/?fromgroups#!forum/user">User Group Mailing List</a>
        </li>
        <li>
      <a class="btn btn-warning" href="https://jira.kiji.org/secure/CreateIssueDetails!init.jspa?pid=10004&issuetype=1&priority=3&components=10010&summary=Reported%20Docs%20Error:%20KijiFreshnessPolicy&description=Please%20describe%20the%20issue.%0a%0aurl:%20/userguides/scoring/0.13.0/kiji-freshness-policy"> Report an Error in Docs </a> 
        </li>
    </ul>
    </div>
</div>

  </div>
</div>


      </div>

      <footer>
        <hr/>
        <p>&copy; Kiji Community</p>
      </footer>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35866189-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

