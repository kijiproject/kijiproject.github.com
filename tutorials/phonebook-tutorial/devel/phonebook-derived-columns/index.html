
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Derive Data</title>
    <meta name="description" content="Decompose an address into its individual fields.">
    <meta name="author" content="WibiData">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/github.css" rel="stylesheet" type="text/css" media="all">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="/assets/themes/twitter/vallenato/vallenato.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/assets/themes/twitter/css/vallenato.css" type="text/css" media="screen">

  </head>

  <body>
    <div class="navbar navbar-fixed-top">
           
      <div class="navbar-inner">
                     
        <div class="container-fluid">
         <a class="brand" href="http://www.kiji.org">
           <img src="http://www.kiji.org/wp-content/themes/spark/timthumb/timthumb.php?src=http%3A%2F%2Fwww.kiji.org%2Fwp-content%2Fuploads%2F2014%2F03%2FKiji-Logo2.png&h=160&w=0&q=90" style="height: 50px;" alt="Kiji Project">
         </a>
          <ul class="nav pull-right">

            <li class="dropdown">
              <a href="http://www.kiji.org">Home</a>
            </li>
            <li>
              <a href="http://www.kiji.org/#about">About</a>
            </li>
            <li>
              <a href="http://www.kiji.org/#community">Community</a>
            </li>
            <li class="dropdown">
              <a href="/">Download</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/#download">Bento Box</a>
                </li>
                <li class="menu-item">
                  <a href="https://github.com/kijiproject">Github Source</a>
                </li>
              </ul>
            </li>
            <li>
            <li class="dropdown">
              <a href="/">Learn</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://docs.kiji.org/">Documentation</a>
                </li>
                <li class="menu-item">
                  <a href="http://docs.kiji.org/apidocs/">Java Docs</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/category/presentation/">Presentations</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/category/video/">Videos</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.kiji.org/blog/">Blog</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="content">
        
<div class="row-fluid">
  <div class="span9">
    <div class="page-header">
      <h1>Derive Data</h1>
    </div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/phonebook-tutorial/devel/phonebook-import" title="Import Data">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      

      
      
        
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/tutorials/phonebook-tutorial/devel/phonebook-increment" title="Use Counters">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      
      </ul>
    </div>

    <div class="hero-unit">
  <h3>This page is deprecated.</h3>
  <p>
    For a more up-to-date look at how to derive data using Producers, see the
    <a href="/tutorials/music-recommendation/devel/music-overview/">Music
    recommendation tutorial</a>.
    This section is preserved for your reference, but the APIs referenced herein
    are deprecated and may be removed in a future release of KijiSchema.
  </p>
  <p>
    Note that later sections of this tutorial rely on you running the commands
    in this section. But you should not model your future MapReduce analyses on
    the code in <tt>AddressFieldExtractor</tt>.
  </p>
</div>


<p>Your friends have been terribly disorganized about giving you their contact details.
Being the perfectionist you are, you would like to be able to, at any given point, know
how many friends you have in a certain zip code... because obviously, such questions
need answering.</p>

<p>We'll show you a way to decompose your contactsâ€™ addresses into their street address, city,
and zip code (the derived columns) to make it easier for you to get this information quickly.</p>

<h3>AddressFieldExtractor.java</h3>

<p>The run function begins by creating an HBase configuration, and configuring the MapReduce task.
Note that we need to ship certain jars that we depend on during the <em>map</em> task. Here\'s how we
do this:</p>

<div class="highlight"><pre><code class="java"><span class="n">GenericTableMapReduceUtil</span><span class="o">.</span><span class="na">addAllDependencyJars</span><span class="o">(</span><span class="n">job</span><span class="o">);</span>
<span class="n">DistributedCacheJars</span><span class="o">.</span><span class="na">addJarsToDistributedCache</span><span class="o">(</span><span class="n">job</span><span class="o">,</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;KIJI_HOME&quot;</span><span class="o">),</span> <span class="s">&quot;lib&quot;</span><span class="o">));</span>
<span class="n">job</span><span class="o">.</span><span class="na">setUserClassesTakesPrecedence</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</code></pre></div>


<p>The AddressMapper extends Hadoop's Mapper class. The map function is run per row of the Kiji table.
It extracts the address field from each row as follows:</p>

<div class="highlight"><pre><code class="java"><span class="kd">final</span> <span class="n">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getMostRecentValue</span><span class="o">(</span><span class="n">Fields</span><span class="o">.</span><span class="na">INFO_FAMILY</span><span class="o">,</span> <span class="n">Fields</span><span class="o">.</span><span class="na">ADDRESS</span><span class="o">);</span>
</code></pre></div>


<p>Address is the same Avro type you read about on the
<a href="../phonebook-import/">Phonebook Importer</a> page. The JSON
description for it can be found at
<code>$KIJI_HOME/examples/phonebook/src/main/avro/Address.avsc</code>. More information
about Avro types can be found
<a href="http://avro.apache.org/docs/current/spec.html">here</a>.</p>

<p>We decompose and write the individual fields into a derived column using <code>mWriter.put(...)</code>. For
example, the zip code can be extracted from the Address object and written as follows:</p>

<div class="highlight"><pre><code class="java"><span class="n">mWriter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">entityId</span><span class="o">,</span> <span class="n">Fields</span><span class="o">.</span><span class="na">DERIVED_FAMILY</span><span class="o">,</span> <span class="n">Fields</span><span class="o">.</span><span class="na">ZIP</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getZip</span><span class="o">());</span>
</code></pre></div>


<h3>Running the Example</h3>

<p>We assume that you have already imported the contacts from
<code>$KIJI_HOME/examples/phonebook/input-data.txt</code> into the phonebook Kiji table by this point.
You can execute this example using the <code>kiji jar</code> command with the class name:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nv">$KIJI_HOME</span>/bin/kiji jar <span class="se">\</span>
    <span class="nv">$KIJI_HOME</span>/examples/phonebook/lib/kiji-phonebook-1.1.7.jar <span class="se">\</span>
    org.kiji.examples.phonebook.AddressFieldExtractor
</code></pre></div>

</div>


<h4>Verify</h4>

<p>You can use the following command to see if your contacts' address data was successfully extracted:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nv">$KIJI_HOME</span>/bin/kiji scan kiji://.env/default/phonebook/derived
</code></pre></div>

</div>


<pre><code>Scanning kiji table: kiji://localhost:2181/default/phonebook/derived/
entity-id=['John,Doe'] [1384236064962] derived:addr1
                                 1600 Pennsylvania Ave
entity-id=['John,Doe'] [1384236064964] derived:city
                                 Washington
entity-id=['John,Doe'] [1384236064965] derived:state
                                 DC
entity-id=['John,Doe'] [1384236064967] derived:zip
                                 99999

...
</code></pre>


    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/phonebook-tutorial/devel/phonebook-import" title="Import Data">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      

      
      
        
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/tutorials/phonebook-tutorial/devel/phonebook-increment" title="Use Counters">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      
      </ul>
    </div>
  </div>

  <div class="span3">
    
      
      
    
    <div class="side-toc">
    <div class="side-toc-inner">
      <h3>Phonebook Tutorial</h3>
      <ul>
        
          
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-tutorial">Overview</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-setup">Setup</a>
                  
                </li>
              
            
          
            
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-create">Create a Table</a>
                  
                </li>
              
            
          
            
              
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-point-add">Read and Write in Kiji</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-import">Import Data</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <b>Derive Data</b>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-increment">Use Counters</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/phonebook-tutorial/devel/phonebook-delete">Delete Contacts</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
      </ul>
      <h3>Need Help?</h3>
      <ul>
        <li>
      <a class="btn btn-info"  href="https://groups.google.com/a/kiji.org/forum/?fromgroups#!forum/user">User Group Mailing List</a>
        </li>
        <li>
      <a class="btn btn-warning" href="https://jira.kiji.org/secure/CreateIssueDetails!init.jspa?pid=10004&issuetype=1&priority=3&components=10010&summary=Reported%20Docs%20Error:%20Derive Data&description=Please%20describe%20the%20issue.%0a%0aurl:%20/tutorials/phonebook-tutorial/devel/phonebook-derived-columns"> Report an Error in Docs </a> 
        </li>
    </ul>
    </div>
</div>

  </div>
</div>


      </div>

      <footer>
        <hr/>
        <p>&copy; Kiji Community</p>
      </footer>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-REMOVED-DONT-COMMIT']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

