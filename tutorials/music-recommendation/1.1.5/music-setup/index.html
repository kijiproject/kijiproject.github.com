
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Setup</title>
    <meta name="description" content="Setup and compile instructions for the music recommendation tutorial.">
    <meta name="author" content="WibiData">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/github.css" rel="stylesheet" type="text/css" media="all">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="/assets/themes/twitter/vallenato/vallenato.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/assets/themes/twitter/css/vallenato.css" type="text/css" media="screen">
  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="http://www.kiji.org">Kiji Community</a>
          <ul class="nav">
            <li class="dropdown">
              <a href="http://www.kiji.org">The Kiji Project</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/features">Features</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.kiji.org/architecture">Architecture</a>
            </li>
            <li class="dropdown">
              <a href="http://www.kiji.org/getstarted/">Get Started</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Downloads">Downloads</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Installation">Installation</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/get-started-with-maven">Getting Started with Maven</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Training_Services">
                    Training & Services
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="http://www.kiji.org/getinvolved">Get Involved</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Mailing_Lists">Mailing Lists</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Source_Code">Source Code</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Issue_Tracker">Issue Tracking</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.kiji.org/getinvolved/#Contributing_to_Kiji">
                    Contributing to Kiji
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown active">
              <a href="/">Documentation</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.kiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="/tutorials.html">Tutorials</a>
                </li>
                <li class="menu-item">
                  <a href="/userguides.html">
                    User Guides
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/apidocs">API Reference</a>
                </li>
                <li class="menu-item">
                  <a href="https://github.com/kijiproject/wiki/wiki">Wiki</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.kiji.org/blog/">Blog</a>
            </li>
            <li>
              <a href="http://www.kiji.org/aboutkiji">About Kiji</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="content">
        
<div class="row-fluid">
  <div class="span9">
    <div class="page-header">
      <h1>Setup</h1>
    </div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/music-recommendation/1.1.5/music-overview" title="Overview">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      

      
      
        
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/tutorials/music-recommendation/1.1.5/bulk-importing" title="Bulk Importing">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
      
      </ul>
    </div>

    <p>For this tutorial, we assume you are either using the standalone Kiji BentoBox or
have installed the individual components described <a href="http://www.kiji.org/getstarted/">here</a>.
If you don\'t have a working environment yet, you can install the standalone Kiji
BentoBox in <a href="http://www.kiji.org/#tryit">three quick steps!</a></p>

<h3>Start a Kiji Cluster</h3>

<ul>
<li>If you plan to use a BentoBox, run the following command to set BentoBox-related environment
variables and start the Bento cluster:</li>
</ul>


<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> &lt;path/to/bento&gt;
<span class="nb">source </span>bin/kiji-env.sh
bento start
</code></pre></div>

</div>


<p>After BentoBox starts, it displays a list of useful ports for cluster webapps and services.  The
MapReduce JobTracker webapp (<a href="http://localhost:50030">http://localhost:50030</a> in particular will be
useful for this tutorial.</p>

<h3>Compiling</h3>

<p>If you have downloaded the standalone Kiji BentoBox, the code for this tutorial
is already compiled and located in the <code>${KIJI_HOME}/examples/music/</code> directory.
Commands in this tutorial will depend on this location:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nb">export </span><span class="nv">MUSIC_HOME</span><span class="o">=</span><span class="k">${</span><span class="nv">KIJI_HOME</span><span class="k">}</span>/examples/music
</code></pre></div>

</div>


<p>If you are not using the Kiji BentoBox, set <code>MUSIC_HOME</code> to the path of your local
kiji-music repository.</p>

<p>Once you have done this, if you are using Kiji BentoBox you can skip to
"Set your environment variables" if you want to get started playing with the example code.
Otherwise, follow these steps to compile it from source.</p>

<p>The source code for this tutorial can be found in <code>${MUSIC_HOME}</code>.
The source is included along with a Maven project. To get started using Maven,
consult <a href="http://www.kiji.org/get-started-with-maven">Getting started With Maven</a> or
the <a href="http://maven.apache.org/">Apache Maven Homepage</a>.</p>

<p>The following tools are required to compile this project:
* Maven 3.x
* Java 6</p>

<p>To compile, run <code>mvn package</code> from <code>${MUSIC_HOME}</code>. The build
artifacts (.jar files) will be placed in the <code>${MUSIC_HOME}/target/</code>
directory. This tutorial assumes you are using the pre-built jars included with
the music recommendation example under <code>${MUSIC_HOME}/lib/</code>. If you wish to
use jars of example code that you have built, you should adjust the command
lines in this tutorial to use the jars in <code>${MUSIC_HOME}/target/</code>.</p>

<h3>Set your environment variables</h3>

<p>After Bento starts, it will display ports you will need to complete this tutorial. It will be useful
to know the address of the MapReduce JobTracker webapp
(<a href="http://localhost:50030">http://localhost:50030</a> by default) while working through this tutorial.</p>

<p>It will be useful to define an environment variable named <code>KIJI</code> that holds a Kiji URI to the Kiji
instance we'll use during this tutorial.</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nb">export </span><span class="nv">KIJI</span><span class="o">=</span>kiji://.env/kiji_music
</code></pre></div>

</div>


<p>To work through this tutorial, various Kiji tools will require that Avro data
type definitions particular to the working music recommendation example be on the
classpath. You can add your artifacts to the Kiji classpath by running:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash"><span class="nb">export </span><span class="nv">LIBS_DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/lib
<span class="nb">export </span><span class="nv">KIJI_CLASSPATH</span><span class="o">=</span><span class="s2">&quot;${LIBS_DIR}/*&quot;</span>
</code></pre></div>

</div>


<h3>Install Kiji and Create Tables</h3>

<p>Install your Kiji instance:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash">kiji install --kiji<span class="o">=</span><span class="k">${</span><span class="nv">KIJI</span><span class="k">}</span>
</code></pre></div>

</div>


<p>Create the Kiji music tables:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash">kiji-schema-shell --kiji<span class="o">=</span><span class="k">${</span><span class="nv">KIJI</span><span class="k">}</span> --file<span class="o">=</span><span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/music_schema.ddl
</code></pre></div>

</div>


<p>This command uses <a href="https://github.com/kijiproject/kiji-schema-shell">kiji-schema-shell</a>
to create the tables using the KijiSchema DDL, which makes specifying table layouts easy.
See <a href="/userguides/schema/1.4.0/schema-shell-ddl-ref">the KijiSchema DDL Shell reference</a>
for more information on the KijiSchema DDL.</p>

<h5>(Optional) Generate Data</h5>

<p>The music recommendation example comes with pregenerated song data in
<code>${MUSIC_HOME}/example_data</code>.  These .json files contain randomly-generated song information
and randomly-generated usage information for this tutorial.</p>

<p>If you wish to generate new data, wipe the data directory, then use the python script provided.</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash">rm <span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/example_data/*
<span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/bin/data_generator.py --output-dir<span class="o">=</span><span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/example_data/
</code></pre></div>

</div>


<p>This should generate 3 JSON files: <code>example_data/song-dist.json</code>, <code>example_data/song-metadata.json</code>
and <code>example_data/song-plays.json</code>.</p>

<h3>Upload Data to HDFS</h3>

<p>Upload the data set to HDFS (this step is required, even if you did not generate new data):</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash">hadoop fs -mkdir kiji-mr-tutorial
hadoop fs -copyFromLocal <span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/example_data/*.json kiji-mr-tutorial/
</code></pre></div>

</div>


<p>Upload the import descriptor for the bulk-importer in the next section to HDFS:</p>

<div class="userinput">

<div class="highlight"><pre><code class="bash">hadoop fs -copyFromLocal <span class="k">${</span><span class="nv">MUSIC_HOME</span><span class="k">}</span>/import/song-plays-import-descriptor.json kiji-mr-tutorial/
</code></pre></div>

</div>



    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/music-recommendation/1.1.5/music-overview" title="Overview">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
      

      
      
        
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/tutorials/music-recommendation/1.1.5/bulk-importing" title="Bulk Importing">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
      
      </ul>
    </div>
  </div>

  <div class="span3">
    
      
      
    
    <div class="side-toc">
    <div class="side-toc-inner">
      <h3>Music Recommendation Tutorial</h3>
      <ul>
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/music-overview">Overview</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <b>Setup</b>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/bulk-importing">Bulk Importing</a>
                  
                </li>
              
            
          
            
              
            
          
        
          
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/play-count">PlayCount</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/sequential-play-count">SequentialPlayCount</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/next-songs">NextTopSong</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/recommendation-producer">Music Recommendation Producer</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/music-recommendation/1.1.5/followups">Follow Up</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
      </ul>
      <h3>Need Help?</h3>
      <ul>
        <li>
      <a class="btn btn-info"  href="https://groups.google.com/a/kiji.org/forum/?fromgroups#!forum/user">User Group Mailing List</a>
        </li>
        <li>
      <a class="btn btn-warning" href="https://jira.kiji.org/secure/CreateIssueDetails!init.jspa?pid=10004&issuetype=1&priority=3&components=10010&summary=Reported%20Docs%20Error:%20Setup&description=Please%20describe%20the%20issue.%0a%0aurl:%20/tutorials/music-recommendation/1.1.5/music-setup"> Report an Error in Docs </a> 
        </li>
    </ul>
    </div>
</div>

  </div>
</div>


      </div>

      <footer>
        <hr/>
        <p>&copy; Kiji Community</p>
      </footer>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-REMOVED-DONT-COMMIT']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

